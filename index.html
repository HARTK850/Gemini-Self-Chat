<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Chat Pro Ultra - מהדורת פרימיום</title>
    
    <!-- External Fonts and Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@200;300;400;500;600;700;800&family=Heebo:wght@100;300;400;500;700;800;900&family=IBM+Plex+Sans+Hebrew:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="theme-modern">
    <!-- Overlay System -->
    <div id="loadingOverlay" class="overlay loading-overlay">
        <div class="glass-container">
            <div class="spinner-box">
                <div class="circle-core"></div>
            </div>
            <h2 class="loading-title">Gemini Ultra Systems</h2>
            <p id="loadingStatusText">מאתחל מודולים...</p>
        </div>
    </div>

    <div id="notificationContainer" class="notification-container"></div>

    <!-- API Setup Screen -->
    <div id="apiSetupSection" class="full-screen-setup hidden">
        <div class="setup-grid">
            <div class="setup-visual">
                <div class="abstract-blobs"></div>
                <div class="visual-content">
                    <i class="fas fa-microchip icon-pulse"></i>
                    <h2>ברוכים הבאים לעתיד של Gemini</h2>
                    <p>מערכת סימולציית צ'אט מרובת מודלים עם יכולות TTS מתקדמות.</p>
                </div>
            </div>
            <div class="setup-form-area">
                <div class="form-wrapper">
                    <img src="https://www.gstatic.com/lamda/images/gemini_sparkle_v002_d47353046551ce8744c0f.svg" alt="Gemini Logo" class="form-logo">
                    <h3>חיבור API</h3>
                    <p class="subtitle">הזן את המפתח שלך כדי לפתוח את היכולות</p>
                    
                    <div class="input-field">
                        <label for="mainApiKey">מפתח API של Google AI:</label>
                        <div class="input-with-icon">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="mainApiKey" placeholder="AIzaSy...">
                            <button type="button" id="toggleApiVisibility" class="btn-icon">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="api-help">
                        <a href="https://aistudio.google.com/app/apikey" target="_blank">איפה אני מוצא מפתח?</a>
                    </div>
                    
                    <button id="connectApiBtn" class="btn btn-primary btn-block">
                        <span>אימות וחיבור</span>
                        <i class="fas fa-arrow-left"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- App Content -->
    <div id="appInterface" class="app-interface hidden">
        <nav class="top-nav">
            <div class="nav-brand">
                <div class="brand-icon">
                    <i class="fas fa-bolt"></i>
                </div>
                <div class="brand-text">
                    <h1>Gemini Chat Pro</h1>
                    <span class="version-tag">Ultra V2.5</span>
                </div>
            </div>
            
            <div class="nav-center">
                <div id="sessionStats" class="session-stats">
                    <div class="stat-item">
                        <span class="label">מודל נוכחי:</span>
                        <span id="currentModelDisplay" class="value">Gemini 1.5 Pro</span>
                    </div>
                    <div class="stat-divider"></div>
                    <div class="stat-item">
                        <span class="label">טוקנים מוערכים:</span>
                        <span id="tokensDisplay" class="value">0</span>
                    </div>
                </div>
            </div>

            <div class="nav-actions">
                <button id="btnOpenPodcast" class="btn-action" title="פודקאסט">
                    <i class="fas fa-microphone-lines"></i>
                </button>
                <button id="btnOpenSettings" class="btn-action" title="הגדרות">
                    <i class="fas fa-sliders-h"></i>
                </button>
                <div class="user-profile">
                    <div class="avatar">AI</div>
                </div>
            </div>
        </nav>

        <main class="dashboard">
            <aside class="side-panel">
                <div class="panel-header">
                    <h3><i class="fas fa-clock-rotate-left"></i> שיחות אחרונות</h3>
                    <button id="btnNewConversation" class="btn-circle-add">+</button>
                </div>
                <div id="conversationHistory" class="history-scroll">
                    <!-- Dynamic Items -->
                </div>
                <div class="panel-footer">
                    <div class="usage-meter">
                        <div class="usage-label">מכסה חודשית (מדומיין)</div>
                        <div class="progress-bar"><div class="progress-fill" style="width: 65%;"></div></div>
                    </div>
                </div>
            </aside>

            <section class="chat-viewport">
                <div id="emptyState" class="empty-state">
                    <div class="hero-icon-box">
                        <i class="fas fa-comments"></i>
                    </div>
                    <h2>התחל סימולציית מודלים חדשה</h2>
                    <p>הגדר מודל שואל ומודל עונה וצפה באינטראקציה מתקדמת ביניהם.</p>
                    <div class="quick-starts">
                        <button class="btn-quick" data-topic="פילוסופיה של הבינה המלאכותית">
                            <i class="fas fa-brain"></i> פילוסופיה של AI
                        </button>
                        <button class="btn-quick" data-topic="עתיד חקר החלל">
                            <i class="fas fa-rocket"></i> חקר החלל
                        </button>
                        <button class="btn-quick" data-topic="השפעת הטכנולוגיה על החינוך">
                            <i class="fas fa-school"></i> טכנולוגיה בחינוך
                        </button>
                    </div>
                </div>

                <div id="chatDisplay" class="chat-display hidden">
                    <div class="chat-status-bar">
                        <div class="simulation-info">
                            <span id="activeTopicTag" class="topic-tag">נושא: חלל</span>
                            <span id="roundIndicator" class="round-indicator">סיבוב 1/5</span>
                        </div>
                        <div class="simulation-controls">
                            <button id="btnTogglePause" class="ctrl-btn" title="השהיה">
                                <i class="fas fa-pause"></i>
                            </button>
                            <button id="btnStopSimulation" class="ctrl-btn btn-danger" title="עצור">
                                <i class="fas fa-stop"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div id="messageFlow" class="message-flow">
                        <!-- Messages Injected Here -->
                    </div>

                    <div id="typingIndicator" class="typing-indicator hidden">
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <span id="typingText">Gemini חושב...</span>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal: Global Settings -->
    <div id="modalSettings" class="modal-overlay hidden">
        <div class="modal-box">
            <div class="modal-header">
                <h3>הגדרות מערכת מתקדמות</h3>
                <button class="close-modal"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="tabs-nav">
                    <button class="tab-btn active" data-tab="models">מודלים</button>
                    <button class="tab-btn" data-tab="behavior">התנהגות</button>
                    <button class="tab-btn" data-tab="advanced">אבטחה</button>
                </div>
                <div class="tab-content" id="tab-models">
                    <div class="form-group">
                        <label>מודל עונה ראשי (Respondent):</label>
                        <select id="selModelRespondent">
                            <option value="gemini-1.5-pro">Gemini 1.5 Pro (יציב וחכם)</option>
                            <option value="gemini-1.5-flash">Gemini 1.5 Flash (מהיר וקליל)</option>
                            <option value="gemini-2.0-flash-exp">Gemini 2.0 Flash (ניסיוני/חדש)</option>
                        </select>
                        <p class="field-desc">המודל שיספק את התשובות העיקריות לשאלות.</p>
                    </div>
                    <div class="form-group">
                        <label>מודל שואל (Inquirer):</label>
                        <select id="selModelInquirer">
                            <option value="gemini-1.5-flash">Gemini 1.5 Flash (מומלץ למהירות)</option>
                            <option value="gemini-1.5-pro">Gemini 1.5 Pro (שאלות מעמיקות)</option>
                            <option value="gemini-2.0-flash-exp">Gemini 2.0 Flash</option>
                        </select>
                        <p class="field-desc">המודל שיתפקד כמראיין או כמאתגר בשיחה.</p>
                    </div>
                </div>
                <div class="tab-content hidden" id="tab-behavior">
                    <div class="form-group">
                        <label>שיטת הגבלת שיחה:</label>
                        <select id="selLimitMode">
                            <option value="fixed">מספר סיבובים קבוע</option>
                            <option value="infinite">ללא הגבלה (עד לעצירה ידנית)</option>
                        </select>
                    </div>
                    <div id="fixedRoundsContainer" class="form-group">
                        <label>מספר סיבובים מקסימלי:</label>
                        <input type="range" id="rangeRounds" min="1" max="50" value="5">
                        <div class="range-value"><span id="valRounds">5</span> סיבובים</div>
                    </div>
                    <div class="token-calculator">
                        <div class="calc-header">הערכת עלות טוקנים (לחבילת סיבובים)</div>
                        <div class="calc-result"><i class="fas fa-coins"></i> <span id="estTokens">~1,200</span> Tokens</div>
                    </div>
                </div>
                <div class="tab-content hidden" id="tab-advanced">
                    <div class="form-group">
                        <label>עדכון מפתח API:</label>
                        <input type="password" id="inputUpdateKey" placeholder="הכנס מפתח חדש לשמירה...">
                    </div>
                    <button id="btnClearData" class="btn btn-danger-outline">נקה את כל נתוני האפליקציה</button>
                </div>
            </div>
            <div class="modal-footer">
                <button id="btnSaveAllSettings" class="btn btn-primary">שמור והחל שינויים</button>
            </div>
        </div>
    </div>

    <!-- Modal: Podcast Generator -->
    <div id="modalPodcast" class="modal-overlay hidden">
        <div class="modal-box podcast-box">
            <div class="modal-header">
                <h3><i class="fas fa-podcast"></i> מחולל פודקאסט AI</h3>
                <button class="close-modal"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body center-content">
                <div class="podcast-visual">
                    <div class="waveform">
                        <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
                    </div>
                    <i class="fas fa-microphone-alt main-mic"></i>
                </div>
                
                <div id="podcastStatusInfo" class="status-info">
                    <h4>מוכן להמרה</h4>
                    <p>המערכת תמיר את היסטוריית הצ'אט הנוכחית לשיחת פודקאסט בין שני דוברים (Puck ו-Charon).</p>
                </div>

                <div id="audioPlayerWrapper" class="audio-wrapper hidden">
                    <div class="player-ui">
                        <div class="player-info">
                            <span class="file-name">Gemini_Podcast_Export.wav</span>
                            <span id="audioDuration">0:00</span>
                        </div>
                        <audio id="mainAudioPlayer" controls></audio>
                    </div>
                    <a id="downloadAudioLink" class="btn btn-success btn-block" download="podcast.wav">
                        <i class="fas fa-download"></i> הורד קובץ שמע
                    </a>
                </div>

                <div id="ttsProgress" class="tts-progress hidden">
                    <div class="progress-ring"></div>
                    <p>מעבד שמע באמצעות Gemini 2.5 Flash TTS...</p>
                </div>

                <button id="btnGeneratePodcast" class="btn btn-primary btn-lg">
                    <i class="fas fa-wand-magic-sparkles"></i> צור פודקאסט מהשיחה
                </button>
            </div>
        </div>
    </div>

    <!-- Modal: Setup Simulation -->
    <div id="modalInitChat" class="modal-overlay hidden">
        <div class="modal-box">
            <div class="modal-header">
                <h3>הגדרת סימולציה חדשה</h3>
                <button class="close-modal"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>נושא השיחה (Topic):</label>
                    <input type="text" id="inputTopic" placeholder="למשל: ההתפתחות של רפואה מותאמת אישית...">
                </div>
                <div class="form-group">
                    <label>הנחיות למערכת (System Instructions) - מודל עונה:</label>
                    <textarea id="promptRespondent" rows="4">אתה מומחה בתחום, עונה בצורה אובייקטיבית, מפורטת ומקצועית. השתמש בשפה עשירה וסימוכין לוגיים.</textarea>
                </div>
                <div class="form-group">
                    <label>הנחיות למערכת - מודל שואל:</label>
                    <textarea id="promptInquirer" rows="4">אתה מראיין סקרן ומאתגר. שאל שאלות המשך שחופרות עמוק בתוך התשובות שאתה מקבל. אל תהסס להצביע על סתירות.</textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button id="btnLaunchSimulation" class="btn btn-primary btn-block">שגר סימולציה</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="script.js" type="module"></script>
</body>
</html>
